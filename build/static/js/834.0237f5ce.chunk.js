"use strict";(self.webpackChunkchat=self.webpackChunkchat||[]).push([[834],{65796:function(e,n,t){t.d(n,{Z:function(){return w}});var r=t(70885),i=t(697),o=t(36314),s=t(82880),c=t(39709),u=t(72791),l=t(13967),a=(t(10155),t(85670),t(86026)),d=t(59434),f=(t.p,t(67394)),p=t(57689),h=t(53329),x=t(80184),w=function(e){var n=e.type,t=(0,d.I0)(),w=(0,p.s0)(),g=(0,l.Z)(),v=(0,d.v9)((function(e){return e.app})),y=v.isRating,j=v.identify,Z=(v.history,v.isEnd),m=(0,u.useState)(""),b=(0,r.Z)(m,2),R=b[0],k=b[1];function C(){y||(window.isRating=!0,t((0,a._Q)({history:[]})),t((0,a._3)({isRating:!0})),window.ws&&window.ws.send(JSON.stringify({cmd:"score"})))}return(0,u.useEffect)((function(){if("chat"!==j){var e=Date.now()+9e5,n=setInterval((function(){var t=Date.now();if(t>=e)return k("00:00"),clearInterval(n),void C();var r=Math.floor((e-t)/1e3),i=r%60,o=(r-i)/60;i=i<10?"0"+i:i,k("".concat(o=o<10?"0"+o:o,":").concat(i))}),1e3);return function(){n&&clearInterval(n)}}}),[]),(0,x.jsxs)(i.Z,{p:2,sx:{width:"100%",height:"74px",backgroundColor:"light"===g.palette.mode?"#F8FAFF":g.palette.background.paper,boxShadow:"0px 0px 2px rgba(0,0,0,0.25)"},children:[(0,x.jsx)(o.Z,{alignItems:"center",direction:"row",justifyContent:"space-between",sx:{width:"100%",height:"100%"},children:(0,x.jsxs)(o.Z,{sx:{width:"100%"},onClick:function(){t((0,a.Xk)())},direction:"row",justifyContent:"space-between",spacing:2,children:[(0,x.jsx)(f.Z,{onClick:function(){var e,n;window.player&&(null===(e=window.player)||void 0===e||null===(n=e.pause)||void 0===n||n.call(e),window.isPlaying=!1),t((0,a._Q)({history:[]})),t((0,a._3)({isRating:!1})),t((0,a.Vs)({score:[]})),w("/index")}}),"score"===n?null:(0,x.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",columnGap:"18px"},children:["chat"!==j?(0,x.jsx)("div",{children:R}):null,"chat"!==j?y?(0,x.jsx)(c.Z,{endIcon:(0,x.jsx)(h.Z,{}),loading:!0,loadingPosition:"end",variant:"contained",children:(0,x.jsx)("span",{children:"\u8bc4\u5206\u4e2d"})}):(0,x.jsx)(s.Z,{variant:"contained",onClick:C,color:"success",style:{backgroundColor:"#39b213",color:"#FFF"},children:"\u7ed3\u675f\u5e76\u8bc4\u5206"}):null]})]})}),Z?(0,x.jsx)("div",{style:{position:"fixed",zIndex:1e4,top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center"},children:(0,x.jsxs)("div",{style:{borderRadius:"10px",background:"#fff",padding:"16px 24px",width:"80%",display:"flex",flexDirection:"column"},children:[(0,x.jsx)("div",{style:{fontSize:"18px",color:"#212B36",fontWeight:700},children:"\u63d0\u793a"}),(0,x.jsx)("div",{style:{fontSize:"16px",color:"#637381",marginTop:"12px"},children:"\u8003\u8bd5\u5df2\u7ed3\u675f"}),(0,x.jsx)("div",{style:{color:"#0162C4",fontSize:"14px",cursor:"pointer",marginTop:"24px",width:"fit-content",alignSelf:"flex-end"},onClick:function(){C(),t((0,a.fw)({isEnd:!1}))},children:"\u786e\u5b9a"})]})}):null]})}},43867:function(e,n,t){var r=t(697),i=t(36314),o=(t(72791),t(59434)),s=t(90470),c=t(80184);n.Z=function(e){e.menu;var n=(0,o.v9)((function(e){return e.app})).history;return console.log(n),(0,c.jsx)(r.Z,{p:3,children:(0,c.jsx)(i.Z,{spacing:3,children:n.map((function(e,n){switch(e.type){case"divider":return null;case"msg":switch(e.subtype){case"image":return(0,c.jsx)(s.y1,{el:e},n);case"doc":return(0,c.jsx)(s.RL,{el:e},n);case"audio":return(0,c.jsx)(s.FZ,{el:e},n);case"link":return(0,c.jsx)(s.V5,{el:e},n);case"reply":return(0,c.jsx)(s.Q8,{el:e},n);case"progress":return(0,c.jsx)(s.LO,{el:e},n);default:return(0,c.jsx)(s.w8,{el:e},n)}break;default:return(0,c.jsx)(c.Fragment,{})}}))})})}},61385:function(e,n,t){t.d(n,{Z:function(){return E}});var r=t(36314),i=t(697),o=t(72791),s=t(13967),c=t(65796),u=t(74165),l=t(15861),a=t(70885),d=t(58165),f=t(13400),p=t(59434),h=t(66934),x=t(76526),w=t(46206),g=t(22413),v=t(6880),y=t(59134),j=(t(24122),t(15122),t(86026)),Z=t(2703),m=t(57689),b=(t(90179),t(76838)),R=t(17097),k=t(43753),C=t.n(k),F=(t(91296),t(39992),t(80184)),I=((0,h.ZP)(d.Z)((function(e){e.theme;return{"& .MuiInputBase-input":{paddingTop:"12px",paddingBottom:"12px"}}})),x.Z,w.Z,g.Z,v.Z,y.Z,function(){(0,p.I0)(),(0,m.s0)();var e=(0,s.Z)(),n=(0,o.useState)(!1),t=(0,a.Z)(n,2),c=(t[0],t[1],(0,o.useRef)(null),(0,o.useState)("")),d=(0,a.Z)(c,2),h=d[0],x=(d[1],(0,o.useRef)("")),w=((0,p.v9)((function(e){return e.app})),(0,p.v9)((function(e){return e.app}))),g=(w.history,w.isRating),v=w.identify,y=w.isEnd,j=((0,o.useRef)(!1),(0,o.useRef)()),k=(0,o.useRef)(""),I=((0,o.useRef)(),(0,o.useRef)()),S=((0,o.useRef)(),(0,o.useRef)(),(0,o.useRef)(),(0,o.useRef)([]),(0,o.useState)(!1)),E=(0,a.Z)(S,2),A=E[0],T=E[1],L=(0,o.useState)(),N=(0,a.Z)(L,2);N[0],N[1],(0,o.useRef)([]),(0,o.useRef)(!1);function _(){j.current.start()}function z(e){j.current.stop(function(){var n=(0,l.Z)((0,u.Z)().mark((function n(t,r){var i;return(0,u.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,Z.w8)(t);case 2:k.current=n.sent,i=(window.URL||window.webkitURL).createObjectURL(t),console.log(t,i,"\u65f6\u957f:"+r+"ms"),j.current.close(),j.current=null,e&&e();case 8:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}(),(function(e){console.log("\u5f55\u97f3\u5931\u8d25:"+e),j.current.close(),j.current=null}))}var O=function(){var e=k.current.split(",")[1];window.userAudioArr||(window.userAudioArr=[]),window.userAudioArr.push(e),window.ws&&window.ws.send(JSON.stringify({cmd:"chat"===v?"chat":"answer",audio:e}))},D=function(){A||(T(!0),j.current?(_(),I.current=setTimeout((function(){A&&(z(O),T(!1)),clearTimeout(I.current)}),55e3)):function(e){var n;j.current&&(null===(n=j.current)||void 0===n||n.close(),j.current=null),j.current=C()({type:"mp3",sampleRate:16e3,bitRate:16,onProcess:function(e,n,t,r,i,o){}}),j.current.open((function(){e&&e()}),(function(e,n){console.log((n?"UserNotAllow\uff0c":"")+"\u65e0\u6cd5\u5f55\u97f3:"+e),alert(JSON.stringify(e)+n)}))}((function(){_(),I.current=setTimeout((function(){A&&(z(O),T(!1)),clearTimeout(I.current)}),55e3)})))};function M(){return(M=(0,l.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return clearTimeout(I.current),I.current=null,z(O),T(!1),e.abrupt("return");case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(){A?function(){M.apply(this,arguments)}():D()}var Q=function(e){"Enter"===e.key&&P()};return(0,o.useEffect)((function(){x.current=h}),[h]),(0,o.useEffect)((function(){return document.addEventListener("keydown",Q),function(){document.removeEventListener("keydown",Q)}}),[]),g||y?null:(0,F.jsx)(i.Z,{sx:{height:38,width:48,backgroundColor:e.palette.primary.main,borderRadius:1.5},style:{position:"fixed",bottom:"12px",right:"12px"},children:(0,F.jsx)(r.Z,{sx:{height:"100%",width:"100%",alignItems:"center",justifyContent:"center"},children:(0,F.jsx)(f.Z,{onClick:P,children:A?(0,F.jsx)(b.Z,{style:{color:"#FFF"}}):(0,F.jsx)(R.Z,{style:{color:"#FFF"}})})})})}),S=t(43867),E=function(){var e=(0,p.v9)((function(e){return e.app})),n=e.history,t=e.preview,u=(0,p.I0)(),l=((0,s.Z)(),(0,o.useRef)(null));return(0,o.useEffect)((function(){l.current.scrollTo({top:Number.MAX_SAFE_INTEGER,behavior:"smooth"})}),[n.length]),(0,F.jsxs)(r.Z,{height:"100%",width:"auto",children:[(0,F.jsx)(c.Z,{}),(0,F.jsx)(i.Z,{className:"scrollbar",ref:l,width:"100%",sx:{flex:1,overflowY:"scroll"},children:(0,F.jsx)(S.Z,{})}),t.isShow&&(0,F.jsx)("div",{onClick:function(){u((0,j.Qp)({isShow:!1,url:""}))},style:{zIndex:1e3,position:"fixed",width:"100vw",height:"100vh",backgroundColor:"rgba(0, 0, 0, 0.6)",display:"flex",justifyContent:"center",alignItems:"center"},children:(0,F.jsx)("img",{style:{width:window.isMobile?"100%":"70%"},src:t.url})}),(0,F.jsx)(I,{})]})}}}]);
//# sourceMappingURL=834.0237f5ce.chunk.js.map